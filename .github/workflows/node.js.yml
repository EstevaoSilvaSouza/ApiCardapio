# This workflow will do a clean installation of node dependencies, cache/restore them, build the source code and run tests across different versions of node
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-nodejs

name: CI/CD API CardapioWeb - Deploy Main üê±‚Äçüë§üê±‚ÄçüöÄ

on:
  push:
    branches: [ "Main" ]
  pull_request:
    branches: [ "Main" ]

jobs:
  build:

    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [14.x, 16.x, 18.x]
        # See supported Node.js release schedule at https://nodejs.org/en/about/releases/

    steps:
    - uses: actions/checkout@v3
    - name: Use Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v3
      with:
        node-version: ${{ matrix.node-version }}
    - name: Instala√ß√£o do NPM Install
      run: npm i -y
      
    - name: Instala√ß√£o pacotes de Desenvolvimento
      run: |
          npm install --save-dev @types/cookie-parser@^1.4.6 \
          @types/cors@^2.8.13 \
          @types/express@^4.17.17 \
          @types/jsonwebtoken@^9.0.5 \
          @types/node@^20.4.0 \
          @vercel/node@^2.15.5 \
          nodemon@^3.0.2 \
          ts-node@^10.9.1
    - name: Instala√ß√£o dos pacotes De Produ√ß√£o NPM 
      run: |
          npm install --save cookie-parser@^1.4.6 \
          cors@^2.8.5 \
          express@^4.18.2 \
          jsonwebtoken@^9.0.2 \
          mysql2@^3.5.0 \
          pg-hstore@^2.3.4 \
          sequelize@^6.32.1 \
          socket.io@^4.7.4
    - name: Buildando a aplica√ß√£o para a pasta build/index.js
      run : npm run build
    - name: Rodando a API para testar
      run : node build/index.js
    - name : Aguardando API Iniciar
      run : slep(15)
    - name : FAZENDO REQUEST NA API PARA TESTAR
    - run : curl -sSf http://localhost:3080
